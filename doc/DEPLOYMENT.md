#!/bin/bash

# Deployment Documentation Script

echo "================================================"
echo "Heart Disease Prediction - Deployment Guide"
echo "================================================"

echo -e "\n## LOCAL DEVELOPMENT"
echo "1. Install dependencies:"
echo "   pip install -r requirements.txt"
echo ""
echo "2. Download dataset:"
echo "   python src/data/download_data.py"
echo ""
echo "3. Run training:"
echo "   python scripts/train_model.py"
echo ""
echo "4. Run tests:"
echo "   pytest tests/ -v --cov=src"
echo ""

echo -e "\n## DOCKER DEPLOYMENT"
echo "1. Build image:"
echo "   docker build -f docker/Dockerfile -t heart-disease-api:latest ."
echo ""
echo "2. Run with docker-compose:"
echo "   docker-compose -f docker/docker-compose.yml up -d"
echo ""
echo "3. Access services:"
echo "   API: http://localhost:8000"
echo "   MLflow: http://localhost:5000"
echo "   API Docs: http://localhost:8000/docs"
echo ""

echo -e "\n## KUBERNETES DEPLOYMENT (LOCAL - Minikube)"
echo "1. Start Minikube:"
echo "   minikube start"
echo ""
echo "2. Build Docker image in Minikube:"
echo "   eval \$(minikube docker-env)"
echo "   docker build -f docker/Dockerfile -t heart-disease-api:latest ."
echo ""
echo "3. Deploy application:"
echo "   kubectl apply -f k8s/deployment.yaml"
echo ""
echo "4. Check deployment:"
echo "   kubectl get pods -n heart-disease-prediction"
echo ""
echo "5. Port forward to access:"
echo "   kubectl port-forward svc/heart-disease-api 8000:80 -n heart-disease-prediction"
echo ""

echo -e "\n## KUBERNETES DEPLOYMENT (CLOUD - GKE/EKS/AKS)"
echo "1. Authenticate with cloud provider:"
echo "   # For GKE:"
echo "   gcloud auth login"
echo "   gcloud container clusters get-credentials <cluster-name>"
echo ""
echo "2. Push Docker image to registry:"
echo "   docker tag heart-disease-api:latest <registry>/heart-disease-api:v1"
echo "   docker push <registry>/heart-disease-api:v1"
echo ""
echo "3. Update deployment image:"
echo "   kubectl set image deployment/heart-disease-api \\"
echo "     api=<registry>/heart-disease-api:v1 \\"
echo "     -n heart-disease-prediction"
echo ""
echo "4. Verify deployment:"
echo "   kubectl get pods -n heart-disease-prediction"
echo "   kubectl logs <pod-name> -n heart-disease-prediction"
echo ""

echo -e "\n## MONITORING STACK"
echo "1. Deploy Prometheus and Grafana:"
echo "   kubectl apply -f monitoring/prometheus-grafana.yaml"
echo ""
echo "2. Access Grafana:"
echo "   kubectl port-forward svc/grafana 3000:3000 -n heart-disease-prediction"
echo "   Open: http://localhost:3000"
echo "   Login: admin / admin"
echo ""
echo "3. Add Prometheus data source:"
echo "   Data Source > Prometheus"
echo "   URL: http://prometheus:9090"
echo ""

echo -e "\n## API TESTING"
echo "1. Test API endpoints:"
echo "   bash scripts/test_api.sh"
echo ""
echo "2. Manual curl tests:"
echo "   curl http://localhost:8000/health"
echo "   curl -X POST http://localhost:8000/predict -d '{...}'"
echo ""

echo -e "\n## CI/CD PIPELINE"
echo "1. Push code to GitHub:"
echo "   git push origin main"
echo ""
echo "2. Monitor GitHub Actions:"
echo "   # GitHub repo > Actions tab"
echo ""
echo "3. Workflow steps:"
echo "   - Linting (flake8, black)"
echo "   - Unit Tests (pytest)"
echo "   - Docker Build"
echo "   - Model Training"
echo ""

echo -e "\n## TROUBLESHOOTING"
echo "1. Check pod logs:"
echo "   kubectl logs -f <pod-name> -n heart-disease-prediction"
echo ""
echo "2. Check pod events:"
echo "   kubectl describe pod <pod-name> -n heart-disease-prediction"
echo ""
echo "3. View API metrics:"
echo "   kubectl port-forward svc/prometheus 9090:9090 -n heart-disease-prediction"
echo "   Open: http://localhost:9090"
echo ""

echo -e "\n================================================"
